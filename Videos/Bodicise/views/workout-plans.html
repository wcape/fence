<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Plans - Bodicise</title>
    <meta name="description" content="Discover AI-powered workout plans tailored to your fitness goals and level.">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="../assets/images/logo.png" alt="Bodicise" class="logo">
                <span class="brand-text">Bodicise</span>
            </div>
            <div class="nav-menu">
                <a href="../index.html" class="nav-link">Home</a>
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="workout-plans.html" class="nav-link active">Workouts</a>
                <a href="progress.html" class="nav-link">Progress</a>
                <a href="profile.html" class="nav-link">Profile</a>
            </div>
            <div class="nav-auth">
                <div class="user-menu">
                    <span class="user-name" id="userName">Loading...</span>
                    <div class="user-dropdown">
                        <button class="dropdown-toggle" onclick="toggleUserMenu()">
                            <img src="../assets/images/default-avatar.png" alt="Profile" class="user-avatar" id="userAvatar">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu" id="userDropdown">
                            <a href="profile.html" class="dropdown-item">
                                <i class="fas fa-user"></i> Profile
                            </a>
                            <a href="settings.html" class="dropdown-item">
                                <i class="fas fa-cog"></i> Settings
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" onclick="AuthController.logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="workout-plans-main">
        <div class="container">
            <!-- Header Section -->
            <section class="workout-header">
                <div class="header-content">
                    <h1 class="page-title">Workout Plans</h1>
                    <p class="page-subtitle">
                        Discover AI-powered workout plans tailored to your fitness goals and level
                    </p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openWorkoutGenerator()">
                        <i class="fas fa-magic"></i>
                        Generate AI Workout
                    </button>
                    <button class="btn btn-outline" onclick="openCustomWorkout()">
                        <i class="fas fa-plus"></i>
                        Create Custom
                    </button>
                </div>
            </section>

            <!-- Filters Section -->
            <section class="filters-section">
                <div class="filters-container">
                    <div class="filter-group">
                        <label for="categoryFilter">Category</label>
                        <select id="categoryFilter" onchange="filterWorkouts()">
                            <option value="">All Categories</option>
                            <option value="strength">Strength</option>
                            <option value="cardio">Cardio</option>
                            <option value="yoga">Yoga</option>
                            <option value="hiit">HIIT</option>
                            <option value="pilates">Pilates</option>
                            <option value="dance">Dance</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="difficultyFilter">Difficulty</label>
                        <select id="difficultyFilter" onchange="filterWorkouts()">
                            <option value="">All Levels</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="durationFilter">Duration</label>
                        <select id="durationFilter" onchange="filterWorkouts()">
                            <option value="">Any Duration</option>
                            <option value="15">15 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60+ minutes</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="equipmentFilter">Equipment</label>
                        <select id="equipmentFilter" onchange="filterWorkouts()">
                            <option value="">Any Equipment</option>
                            <option value="none">No Equipment</option>
                            <option value="dumbbells">Dumbbells</option>
                            <option value="barbell">Barbell</option>
                            <option value="kettlebell">Kettlebell</option>
                            <option value="resistance-bands">Resistance Bands</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="btn btn-outline" onclick="clearFilters()">
                            <i class="fas fa-times"></i>
                            Clear Filters
                        </button>
                    </div>
                </div>
            </section>

            <!-- Workout Plans Grid -->
            <section class="workout-plans-section">
                <div class="section-header">
                    <h2 class="section-title">Featured Workouts</h2>
                    <div class="view-controls">
                        <button class="view-btn active" onclick="setViewMode('grid')">
                            <i class="fas fa-th"></i>
                        </button>
                        <button class="view-btn" onclick="setViewMode('list')">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
                
                <div class="workout-plans-grid" id="workoutPlansGrid">
                    <!-- Workout plans will be loaded here -->
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading workout plans...</p>
                    </div>
                </div>
            </section>

            <!-- My Workouts Section -->
            <section class="my-workouts-section">
                <div class="section-header">
                    <h2 class="section-title">My Workouts</h2>
                    <div class="section-tabs">
                        <button class="tab-btn active" onclick="switchTab('favorites')">Favorites</button>
                        <button class="tab-btn" onclick="switchTab('recent')">Recent</button>
                        <button class="tab-btn" onclick="switchTab('custom')">Custom</button>
                    </div>
                </div>
                
                <div class="my-workouts-content">
                    <div id="favoritesTab" class="tab-content active">
                        <div class="workout-plans-grid" id="favoritesGrid">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Loading favorites...</p>
                            </div>
                        </div>
                    </div>
                    <div id="recentTab" class="tab-content">
                        <div class="workout-plans-grid" id="recentGrid">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Loading recent workouts...</p>
                            </div>
                        </div>
                    </div>
                    <div id="customTab" class="tab-content">
                        <div class="workout-plans-grid" id="customGrid">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Loading custom workouts...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Workout Generator Modal -->
    <div id="workoutGeneratorModal" class="modal">
        <div class="modal-content large">
            <span class="modal-close" onclick="closeWorkoutGenerator()">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title">Generate AI Workout</h2>
                <p class="modal-subtitle">Tell us about your preferences and we'll create a personalized workout</p>
            </div>
            <div class="modal-body">
                <form id="workoutGeneratorForm" onsubmit="generateWorkout(event)">
                    <div class="form-section">
                        <h3 class="form-section-title">Workout Preferences</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="workoutType">Workout Type</label>
                                <select id="workoutType" name="workoutType" required>
                                    <option value="">Select workout type</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="hiit">HIIT</option>
                                    <option value="yoga">Yoga</option>
                                    <option value="pilates">Pilates</option>
                                    <option value="mixed">Mixed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="workoutDuration">Duration (minutes)</label>
                                <input type="number" id="workoutDuration" name="workoutDuration" 
                                       min="15" max="120" value="30" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="workoutDifficulty">Difficulty Level</label>
                                <select id="workoutDifficulty" name="workoutDifficulty" required>
                                    <option value="">Select difficulty</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="availableEquipment">Available Equipment</label>
                                <select id="availableEquipment" name="availableEquipment" required>
                                    <option value="">Select equipment</option>
                                    <option value="none">No Equipment</option>
                                    <option value="dumbbells">Dumbbells</option>
                                    <option value="barbell">Barbell</option>
                                    <option value="kettlebell">Kettlebell</option>
                                    <option value="resistance-bands">Resistance Bands</option>
                                    <option value="full-gym">Full Gym Access</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="workoutGoals">Primary Goals</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="goals" value="weight_loss">
                                    <span class="checkmark"></span>
                                    Weight Loss
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="goals" value="muscle_gain">
                                    <span class="checkmark"></span>
                                    Muscle Gain
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="goals" value="endurance">
                                    <span class="checkmark"></span>
                                    Endurance
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="goals" value="flexibility">
                                    <span class="checkmark"></span>
                                    Flexibility
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="goals" value="strength">
                                    <span class="checkmark"></span>
                                    Strength
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="workoutNotes">Additional Notes</label>
                            <textarea id="workoutNotes" name="workoutNotes" 
                                      placeholder="Any specific preferences, injuries, or areas you'd like to focus on..."></textarea>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="closeWorkoutGenerator()">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-magic"></i>
                            Generate Workout
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Workout Preview Modal -->
    <div id="workoutPreviewModal" class="modal">
        <div class="modal-content large">
            <span class="modal-close" onclick="closeWorkoutPreview()">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title" id="previewTitle">Workout Preview</h2>
                <p class="modal-subtitle" id="previewSubtitle">Review your workout before starting</p>
            </div>
            <div class="modal-body">
                <div id="workoutPreviewContent">
                    <!-- Workout preview content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeWorkoutPreview()">
                    Close
                </button>
                <button type="button" class="btn btn-primary" onclick="startWorkout()">
                    <i class="fas fa-play"></i>
                    Start Workout
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/app.js"></script>
    <script src="../assets/js/api-client.js"></script>
    <script src="../assets/js/utils.js"></script>
    
    <!-- Load Controllers -->
    <script src="../controllers/auth-controller.html"></script>
    <script src="../controllers/user-controller.html"></script>
    <script src="../controllers/workout-controller.html"></script>
    
    <!-- Workout Plans Scripts -->
    <script>
        let currentViewMode = 'grid';
        let currentTab = 'favorites';
        let currentWorkout = null;

        // Initialize workout plans page
        document.addEventListener('DOMContentLoaded', function() {
            initializeWorkoutPlans();
        });

        async function initializeWorkoutPlans() {
            try {
                // Check authentication
                AuthController.checkAuthStatus();
                
                // Load user data
                await UserController.loadUserProfile();
                updateUserInfo();
                
                // Load workout plans
                await loadWorkoutPlans();
                
                // Load my workouts
                await loadMyWorkouts();
                
            } catch (error) {
                console.error('Failed to initialize workout plans:', error);
            }
        }

        function updateUserInfo() {
            const user = UserController.currentUser;
            if (user) {
                document.getElementById('userName').textContent = user.firstName;
                document.getElementById('userAvatar').src = user.avatar || '../assets/images/default-avatar.png';
            }
        }

        async function loadWorkoutPlans() {
            try {
                const workouts = await WorkoutController.getWorkoutLibrary();
                displayWorkoutPlans(workouts);
            } catch (error) {
                document.getElementById('workoutPlansGrid').innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Failed to load workout plans</p>
                        <button class="btn btn-primary" onclick="loadWorkoutPlans()">
                            Try Again
                        </button>
                    </div>
                `;
            }
        }

        function displayWorkoutPlans(workouts) {
            const container = document.getElementById('workoutPlansGrid');
            container.innerHTML = workouts.map(workout => `
                <div class="workout-card" data-category="${workout.category}" 
                     data-difficulty="${workout.difficulty}" data-duration="${workout.duration}">
                    <div class="workout-image">
                        <img src="${workout.image}" alt="${workout.name}">
                        <div class="workout-overlay">
                            <button class="btn btn-primary btn-sm" onclick="previewWorkout('${workout.id}')">
                                <i class="fas fa-eye"></i>
                                Preview
                            </button>
                        </div>
                    </div>
                    <div class="workout-content">
                        <div class="workout-header">
                            <h3 class="workout-name">${workout.name}</h3>
                            <div class="workout-rating">
                                <i class="fas fa-star"></i>
                                <span>${workout.rating}</span>
                            </div>
                        </div>
                        <p class="workout-description">${workout.description}</p>
                        <div class="workout-meta">
                            <span class="workout-duration">
                                <i class="fas fa-clock"></i>
                                ${workout.duration} min
                            </span>
                            <span class="workout-difficulty">
                                <i class="fas fa-signal"></i>
                                ${workout.difficulty}
                            </span>
                            <span class="workout-calories">
                                <i class="fas fa-fire"></i>
                                ${workout.calories} cal
                            </span>
                        </div>
                        <div class="workout-actions">
                            <button class="btn btn-primary" onclick="startWorkout('${workout.id}')">
                                <i class="fas fa-play"></i>
                                Start
                            </button>
                            <button class="btn btn-outline" onclick="toggleFavorite('${workout.id}')">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function loadMyWorkouts() {
            try {
                // Load favorites
                const favorites = await WorkoutController.getFavorites();
                displayFavorites(favorites);
                
                // Load recent workouts
                const recent = await WorkoutController.getRecentWorkouts();
                displayRecentWorkouts(recent);
                
                // Load custom workouts
                const custom = await WorkoutController.getCustomWorkouts();
                displayCustomWorkouts(custom);
                
            } catch (error) {
                console.error('Failed to load my workouts:', error);
            }
        }

        function displayFavorites(favorites) {
            const container = document.getElementById('favoritesGrid');
            if (favorites.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-heart"></i>
                        <p>No favorite workouts yet</p>
                        <p>Start exploring workouts and add them to your favorites!</p>
                    </div>
                `;
            } else {
                container.innerHTML = favorites.map(workout => createWorkoutCard(workout)).join('');
            }
        }

        function displayRecentWorkouts(recent) {
            const container = document.getElementById('recentGrid');
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>No recent workouts</p>
                        <p>Start your first workout to see it here!</p>
                    </div>
                `;
            } else {
                container.innerHTML = recent.map(workout => createWorkoutCard(workout)).join('');
            }
        }

        function displayCustomWorkouts(custom) {
            const container = document.getElementById('customGrid');
            if (custom.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-plus"></i>
                        <p>No custom workouts</p>
                        <p>Create your first custom workout!</p>
                        <button class="btn btn-primary" onclick="openCustomWorkout()">
                            Create Custom Workout
                        </button>
                    </div>
                `;
            } else {
                container.innerHTML = custom.map(workout => createWorkoutCard(workout)).join('');
            }
        }

        function createWorkoutCard(workout) {
            return `
                <div class="workout-card">
                    <div class="workout-image">
                        <img src="${workout.image}" alt="${workout.name}">
                        <div class="workout-overlay">
                            <button class="btn btn-primary btn-sm" onclick="previewWorkout('${workout.id}')">
                                <i class="fas fa-eye"></i>
                                Preview
                            </button>
                        </div>
                    </div>
                    <div class="workout-content">
                        <div class="workout-header">
                            <h3 class="workout-name">${workout.name}</h3>
                            <div class="workout-rating">
                                <i class="fas fa-star"></i>
                                <span>${workout.rating}</span>
                            </div>
                        </div>
                        <p class="workout-description">${workout.description}</p>
                        <div class="workout-meta">
                            <span class="workout-duration">
                                <i class="fas fa-clock"></i>
                                ${workout.duration} min
                            </span>
                            <span class="workout-difficulty">
                                <i class="fas fa-signal"></i>
                                ${workout.difficulty}
                            </span>
                            <span class="workout-calories">
                                <i class="fas fa-fire"></i>
                                ${workout.calories} cal
                            </span>
                        </div>
                        <div class="workout-actions">
                            <button class="btn btn-primary" onclick="startWorkout('${workout.id}')">
                                <i class="fas fa-play"></i>
                                Start
                            </button>
                            <button class="btn btn-outline" onclick="toggleFavorite('${workout.id}')">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Filter functions
        function filterWorkouts() {
            const category = document.getElementById('categoryFilter').value;
            const difficulty = document.getElementById('difficultyFilter').value;
            const duration = document.getElementById('durationFilter').value;
            const equipment = document.getElementById('equipmentFilter').value;

            const workoutCards = document.querySelectorAll('.workout-card');
            
            workoutCards.forEach(card => {
                const cardCategory = card.dataset.category;
                const cardDifficulty = card.dataset.difficulty;
                const cardDuration = parseInt(card.dataset.duration);
                
                let show = true;
                
                if (category && cardCategory !== category) show = false;
                if (difficulty && cardDifficulty !== difficulty) show = false;
                if (duration && cardDuration < parseInt(duration)) show = false;
                
                card.style.display = show ? 'block' : 'none';
            });
        }

        function clearFilters() {
            document.getElementById('categoryFilter').value = '';
            document.getElementById('difficultyFilter').value = '';
            document.getElementById('durationFilter').value = '';
            document.getElementById('equipmentFilter').value = '';
            
            const workoutCards = document.querySelectorAll('.workout-card');
            workoutCards.forEach(card => {
                card.style.display = 'block';
            });
        }

        // View mode functions
        function setViewMode(mode) {
            currentViewMode = mode;
            
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const grid = document.getElementById('workoutPlansGrid');
            grid.className = mode === 'grid' ? 'workout-plans-grid' : 'workout-plans-list';
        }

        // Tab functions
        function switchTab(tab) {
            currentTab = tab;
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tab}Tab`).classList.add('active');
        }

        // Modal functions
        function openWorkoutGenerator() {
            document.getElementById('workoutGeneratorModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeWorkoutGenerator() {
            document.getElementById('workoutGeneratorModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function openCustomWorkout() {
            // Open custom workout creation modal
            console.log('Open custom workout');
        }

        async function generateWorkout(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const workoutData = {
                type: formData.get('workoutType'),
                duration: formData.get('workoutDuration'),
                difficulty: formData.get('workoutDifficulty'),
                equipment: formData.get('availableEquipment'),
                goals: formData.getAll('goals'),
                notes: formData.get('workoutNotes')
            };

            try {
                const workout = await WorkoutController.generateWorkoutPlan(workoutData);
                currentWorkout = workout;
                
                closeWorkoutGenerator();
                showWorkoutPreview(workout);
                
            } catch (error) {
                Utils.showNotification('Failed to generate workout. Please try again.', 'error');
            }
        }

        function showWorkoutPreview(workout) {
            document.getElementById('previewTitle').textContent = workout.name;
            document.getElementById('previewSubtitle').textContent = workout.description;
            
            document.getElementById('workoutPreviewContent').innerHTML = `
                <div class="workout-preview">
                    <div class="preview-header">
                        <div class="preview-meta">
                            <span class="preview-duration">
                                <i class="fas fa-clock"></i>
                                ${workout.duration} minutes
                            </span>
                            <span class="preview-difficulty">
                                <i class="fas fa-signal"></i>
                                ${workout.difficulty}
                            </span>
                            <span class="preview-calories">
                                <i class="fas fa-fire"></i>
                                ${workout.calories} calories
                            </span>
                        </div>
                    </div>
                    
                    <div class="preview-exercises">
                        <h4>Exercises</h4>
                        <div class="exercises-list">
                            ${workout.exercises.map(exercise => `
                                <div class="exercise-item">
                                    <div class="exercise-info">
                                        <h5>${exercise.name}</h5>
                                        <p>${exercise.description}</p>
                                        <div class="exercise-meta">
                                            <span>${exercise.sets} sets</span>
                                            <span>${exercise.reps} reps</span>
                                            <span>${exercise.duration || 'N/A'}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('workoutPreviewModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeWorkoutPreview() {
            document.getElementById('workoutPreviewModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Workout actions
        async function previewWorkout(workoutId) {
            try {
                const workout = await WorkoutController.getWorkoutPlan(workoutId);
                showWorkoutPreview(workout);
            } catch (error) {
                Utils.showNotification('Failed to load workout preview.', 'error');
            }
        }

        function startWorkout(workoutId) {
            window.location.href = `workout-active.html?id=${workoutId}`;
        }

        async function toggleFavorite(workoutId) {
            try {
                await WorkoutController.saveToFavorites(workoutId);
                Utils.showNotification('Added to favorites!', 'success');
            } catch (error) {
                Utils.showNotification('Failed to add to favorites.', 'error');
            }
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }
    </script>
</body>
</html>

